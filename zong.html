<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kami Flex TV</title>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body {
  margin:0; font-family:sans-serif;
  background:linear-gradient(135deg,#6366f1,#ec4899);
  display:flex; flex-direction:column; align-items:center; min-height:100vh;
}
h1 {color:#fff; margin:10px 0; font-size:1.8rem; display:flex; align-items:center; gap:10px;}
#backBtn{width:40px;height:40px;background:rgba(0,0,0,0.6);color:white;border:none;border-radius:6px;font-size:20px;display:flex;align-items:center;justify-content:center;cursor:pointer;}
#backBtn:hover{background:rgba(255,255,255,0.3);}
.player-box{width:100%; max-width:900px; aspect-ratio:16/9; background:black; border-radius:20px; overflow:hidden; position:sticky; top:5px; margin-bottom:5px; box-shadow:0 10px 25px rgba(0,0,0,0.6);}
#loader{position:absolute;top:0;left:0;right:0;bottom:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:100;visibility:hidden;}
.loader-spin{border:4px solid rgba(255,255,255,0.3);border-top:4px solid #9333ea;border-radius:50%;width:50px;height:50px;animation:spin 1s linear infinite;}
@keyframes spin{100%{transform:rotate(360deg);}}
.controls{position:absolute;bottom:40px;left:0;right:0;display:flex;justify-content:center;align-items:center;opacity:1;transition:opacity 0.4s;flex-wrap:wrap; z-index:20;}
.controls.hidden{opacity:0; pointer-events:none;}
.control-btn{background:rgba(0,0,0,0.6); color:white; width:42px; height:42px; border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 6px; cursor:pointer; transition:0.3s; font-size:18px;}
.control-btn:hover{background:rgba(255,255,255,0.3);}
#channelName{position:absolute;top:2px; left:2px; background:rgba(0,0,0,0.6); color:white; padding:3px 8px; border-radius:6px; font-size:14px; z-index:25;}
#channelGrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(65px,1fr)); gap:8px; padding:5px; max-width:900px; width:100%; overflow-y:auto; margin-top:0;}
.channel-logo{width:65px;height:65px;border-radius:50%;object-fit:cover;cursor:pointer;transition: transform 0.3s, box-shadow 0.3s; border:2px solid transparent; padding:5px;background: rgba(0,0,0,0.2); display:flex; align-items:center; justify-content:center;}
.channel-logo:hover{transform: scale(1.15); box-shadow: 0 0 15px #9333ea; background: rgba(0,0,0,0.35);}
.active-channel{border:2px solid #9333ea; box-shadow:0 0 20px #9333ea; background: rgba(0,0,0,0.35);}
</style>
</head>
<body>

<h1>
  <button id="backBtn" onclick="goBack()">‚Üê</button> üì∫ Kami Flex Live TV
</h1>

<div class="player-box" id="playerBox" onclick="toggleControls()">
  <video id="videoPlayer" class="w-full h-full" autoplay poster="https://i.postimg.cc/LsR6vcVH/Kami-Flex-Player-Icon.jpg"></video>
  <div id="loader"><div class="loader-spin"></div></div>
  <div id="controls" class="controls">
    <button onclick="prevChannel()" class="control-btn">‚èÆ</button>
    <button id="playBtn" onclick="togglePlay()" class="control-btn">‚ñ∂</button>
    <button id="muteBtn" onclick="toggleMute()" class="control-btn">üîä</button>
    <button onclick="nextChannel()" class="control-btn">‚è≠</button>
  </div>
  <div id="channelName">Select a channel</div>
</div>

<div id="channelGrid"></div>

<script src="channels.js"></script>
<script>
let video=document.getElementById("videoPlayer"), playBtn=document.getElementById("playBtn"), muteBtn=document.getElementById("muteBtn"), loader=document.getElementById("loader"), playerBox=document.getElementById("playerBox"), controls=document.getElementById("controls"), channelName=document.getElementById("channelName"), channels=[]; let hls=null, currentIndex=-1;

function playChannel(el,name,url){
  loader.style.visibility="visible";
  currentIndex=channels.indexOf(el);
  channelName.innerText=name;
  channels.forEach(c=>c.classList.remove("active-channel"));
  el.classList.add("active-channel");

  if(hls){ hls.destroy(); hls=null; }
  if(Hls.isSupported()){
    hls=new Hls();
    hls.loadSource(url);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED,()=>{ video.play(); loader.style.visibility="hidden"; playBtn.innerText="‚è∏"; });
  } else if(video.canPlayType('application/vnd.apple.mpegurl')){
    video.src=url;
    video.addEventListener("canplay",()=>{ video.play(); loader.style.visibility="hidden"; playBtn.innerText="‚è∏"; }, {once:true});
  }
}

function prevChannel(){ if(currentIndex>0) channels[currentIndex-1].click(); }
function nextChannel(){ if(currentIndex<channels.length-1) channels[currentIndex+1].click(); }
function togglePlay(){ if(video.paused){ video.play(); playBtn.innerText="‚è∏"; }else{ video.pause(); playBtn.innerText="‚ñ∂"; } }
function toggleMute(){ video.muted=!video.muted; muteBtn.innerText=video.muted?"üîá":"üîä"; }
function toggleControls(){ controls.classList.toggle("hidden"); channelName.classList.toggle("hidden"); }
function goBack(){ window.location.href="index.html"; }

// Update channels array after channels.js loads
document.addEventListener("DOMContentLoaded",()=>{ channels=Array.from(document.querySelectorAll(".channel-logo")); });
</script>

</body>
</html>
